@model GameSpy.DTOs.UserDTO
@using GameSpy.Areas.Identity.Data
@using GameSpy.DTOs
@using Microsoft.AspNetCore.Identity;

@inject MySIgnInManager SignInManager
@inject UserManager<AppUser> userManager;

<head>
    <link rel="stylesheet" href="~/css/userCss.css" />

    <script>
        window.onpageshow = function (event) {
            console.log("onpageshow event fired " + event.persisted);
            if (event.persisted == true) {
                console.log("onpageshow event fired second time");
                window.location.reload();
            }
        };
    </script>
</head>

<body>
    <div class="container-fluid d-flex vh-100 bg-dark p-0">
        <div class="col-2 my-border">
            <div class="w-100 p-3 d-flex">
                <div class="flex-grow-1">
                    <h2 class=" ff-utnr">GameSpy</h2>
                </div>
                <div class="flex-grow-1 align-text-right">
                    <a asp-area="Identity" asp-page="/Account/Logout">
                        <img class="logout" href="#" src="~/assets/exit.png"></img>
                    </a>
                </div>
            </div>
            <div class="h-35  w-100 userInfo">
                <img href="#" src="~/assets/friend.png" class="profile-picture"></img>
                <h3 class="ff-utnr pt-2">@Model.UserName</h3>
            </div>
            <div class="h-54 w-100 d-flex">
                <div class="flex-grow-1 h-25">
                    <p class=" ff-utnr text-center">Games</p>
                    <p class =" ff-utnr text-center">@Model.NumberOfGames</p>
                </div>
                <div class="flex-grow-1 h-25">
                    <p class=" ff-utnr text-center">Achievements</p>
                    <p class=" ff-utnr text-center">@Model.NumberOfAchievements</p>
                </div>
            </div>
        </div>
        <div class="col-8 my-border px-5">
            <div class="w-100 m-3">
                <h2 class="ff-utnr">Recently Played</h2>
            </div>
            <div class="h-26 d-flex w-100 overflow-auto">
                @for (int i=0; i< 6; i++)
                {
                    <a asp-controller="Game" asp-action="SelectedGame" asp-route-id="@Model.RecentGames[i].Gameid">
                        <div class="d-inline-block">
                            <figure class="mx-3 game-holder mt-3" style="--c:#fff5">
                                <img class="custom-image-size" src="~/assets/games/@Model.RecentGames[i].Image" alt="@Model.RecentGames[i].Image">
                                <figcaption>@Model.RecentGames[i].Name</figcaption>
                            </figure>
                        </div>
                    </a>
                }
            </div>
            <div class="h-8 pt-1">
                <div class="h-20 w-100 px-3">
                    <h2 class=" ff-utnr">Your Games</h2>
                </div>
            </div>
            <div class="h-54 d-inline-block overflow-auto">
                @foreach (GameDTO game in Model.Games)
                {
                    <a asp-controller="Game" asp-action="SelectedGame" asp-route-id="@game.Gameid">
                        <div class="d-inline-block">
                            <figure class="mx-3 game-holder mt-3" style="--c:#fff5">
                                <img class="custom-image-size" src="~/assets/games/@game.Image" alt="@game.Image">
                                <figcaption>@game.RecentTime</figcaption>
                            </figure>
                        </div>
                    </a>
                }
            </div>
        </div>
        <div class="col-2 my-border">
            <div class="h-9 d-flex bottom-border px-2">
                <div class="flex-grow-1 ff-utnr h2 mt-3">
                    <a asp-controller="User" asp-action="AddBalance" asp-route-id="@Model.Id">
                        <i class="bi bi-plus-square"></i>
                    </a>
                </div>
                <div class="flex-grow-1 align-text-right ff-utnr h2 mt-3">
                    @Model.Balance $
                </div>
            </div>
            <div class="h-75"></div>
            <div class="h-16 d-flex flex-column align-items-end px-2">
                <div class="h-25 my-1 d-flex justify-content-end w-100">
                    <p class="ff-utnr">Settings</p>
                    <a asp-controller="User" asp-action="UserSettings" asp-route-id="@Model.Id">
                        <img href="#" src="~/assets/settings.png" class="icons mx-1"></img>
                    </a>
                </div>
                <div class="h-25 my-1 d-flex justify-content-end w-100">
                    <p class="ff-utnr">Help</p>
                    <img href="#" src="~/assets/help.png" class="icons mx-1"></img>
                </div>
                <div class="h-25 my-1 d-flex justify-content-end w-100">
                    <p class="ff-utnr">Privacy</p>
                    <img href="#" src="~/assets/privacy.png" class="icons mx-1"></img>
                </div>
            </div>
        </div>
    </div>
</body>